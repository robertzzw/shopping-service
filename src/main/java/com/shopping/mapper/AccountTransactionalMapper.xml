<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.shopping.mapper.AccountTransactionMapper">
    <!-- 基础结果映射 -->
    <resultMap id="BaseResultMap" type="com.shopping.entity.AccountTransaction">
        <id column="transaction_id" property="transactionId" jdbcType="BIGINT"/>
        <result column="transaction_no" property="transactionNo" jdbcType="VARCHAR"/>
        <result column="account_type" property="accountType" jdbcType="TINYINT"/>
        <result column="account_id" property="accountId" jdbcType="BIGINT"/>
        <result column="transaction_type" property="transactionType" jdbcType="TINYINT"/>
        <result column="balance_before" property="balanceBefore" jdbcType="DECIMAL"/>
        <result column="amount" property="amount" jdbcType="DECIMAL"/>
        <result column="balance_after" property="balanceAfter" jdbcType="DECIMAL"/>
        <result column="related_id" property="relatedId" jdbcType="BIGINT"/>
        <result column="related_type" property="relatedType" jdbcType="VARCHAR"/>
        <result column="remark" property="remark" jdbcType="VARCHAR"/>
        <result column="created_time" property="createdTime" jdbcType="TIMESTAMP"/>
    </resultMap>

    <!-- 统计指定账户、日期和交易类型的总金额 -->
    <select id="calculateMerchantNetIncome" resultType="java.math.BigDecimal">
        SELECT
        IFNULL(SUM(amount), 0) as totalAmount
        FROM account_transaction
        WHERE account_id = #{accountId}
            AND DATE(created_time) = #{date}
            AND transaction_type IN (3, 4)
    </select>
</mapper>