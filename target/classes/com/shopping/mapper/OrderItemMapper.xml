<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.shopping.mapper.OrderItemMapper">

    <resultMap id="BaseResultMap" type="com.shopping.entity.OrderItem">
        <id column="item_id" property="itemId"/>
        <result column="order_id" property="orderId"/>
        <result column="sku_id" property="skuId"/>
        <result column="quantity" property="quantity"/>
        <result column="unit_price" property="unitPrice"/>
        <result column="total_price" property="totalPrice"/>
        <result column="created_time" property="createdTime"/>
    </resultMap>

    <!-- 根据订单ID查询明细 -->
    <select id="findByOrderId" resultMap="BaseResultMap">
        SELECT *
        FROM order_item
        WHERE order_id = #{orderId}
        ORDER BY created_time DESC
    </select>

    <!-- 根据SKU ID查询已支付的订单明细 -->
    <select id="findPaidItemsBySkuId" resultMap="BaseResultMap">
        SELECT oi.*
        FROM order_item oi
        JOIN orders o ON oi.order_id = o.id
        WHERE oi.sku_id = #{skuId}
          AND o.order_status IN (1, 3)
        ORDER BY oi.created_time DESC
    </select>

</mapper>